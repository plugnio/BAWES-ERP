generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// TODO: 
// - Relationship between person and organization
// - Consider org relation with accounts for accounting
// - Auth for person and organization, with RBAC implementation via JWT.
// - Phone input unique across different countries / country codes.

model Organization {
  /// Unique identifier for the organization
  id String @id @default(cuid())
  /// English name of the organization
  nameEn String
  /// Arabic name of the organization
  nameAr String
  /// Indicates whether the organization is deleted (soft delete)
  isDeleted Boolean @default(false)

  /// Relation to the organization emails
  emails Email[]
  /// Relation to the organization phones
  phones Phone[]
  // Map the model to the database table
  @@map("organization")
}

/// Person model
model Person {
  /// Unique identifier for the person
  id String @id @default(cuid())
  /// English name of the person
  nameEn String?
  /// Arabic name of the person
  nameAr String?
  /// Indicates whether the person is deleted (soft delete)
  isDeleted Boolean @default(false)

  /// Relation to the person emails
  emails Email[]
  /// Relation to the person phones
  phones Phone[]
  // Map the model to the database table
  @@map("person")
}

/// Person email model, a person/organization can have many emails. An email can be associated with a person/organization or not.
model Email {
  /// Unique identifier for the person email
  id String @id @default(cuid())
  /// Date and time when the email was created
  createdAt DateTime @default(now())
  /// Date and time when the email was last updated
  updatedAt DateTime @updatedAt
  /// Email address of the person
  email String @unique
  /// Indicates whether the email is the primary email of the person
  isPrimary Boolean @default(false)

  /// Unique identifier for the person
  personId String?
  /// Unique identifier for the organization
  organizationId String?

  /// Relation to the person
  person Person? @relation(fields: [personId], references: [id])
  /// Relation to the organization
  organization Organization? @relation(fields: [organizationId], references: [id])
  // Map the model to the database table
  @@map("email")
}

/// Person phone model, a person can have many phones. A phone can be associated with a person or not.
model Phone {
  /// Unique identifier for the person phone
  id String @id @default(cuid())
  /// Date and time when the phone was created
  createdAt DateTime @default(now())
  /// Date and time when the phone was last updated
  updatedAt DateTime @updatedAt
  /// Phone number of the person
  phone String @unique
  /// Indicates whether the phone is the primary phone of the person
  isPrimary Boolean @default(false)

  /// Unique identifier for the person
  personId String?
  /// Unique identifier for the organization
  organizationId String?

  /// Relation to the person
  person Person? @relation(fields: [personId], references: [id])
  /// Relation to the organization
  organization Organization? @relation(fields: [organizationId], references: [id])
  // Map the model to the database table
  @@map("phone")
}

/// Account model for bank accounts
model Account {
  /// Unique identifier for the account
  id              String            @id @default(cuid())
  /// Date and time when the account was created
  createdAt       DateTime          @default(now())
  /// Date and time when the account was last updated
  updatedAt       DateTime          @updatedAt
  /// Label of the account, used for display and identification. optional
  label           String?
  /// Type of the account (savings, checking, credit card, debit card, etc.)
  type            String
  /// Status of the account (active, inactive, closed, etc.)
  status          String
  /// Currency of the account
  currency        String
  /// Balance of the account
  balance         Decimal
  /// Indicates whether the account is deleted (soft delete)
  isDeleted       Boolean           @default(false)

  /// Optional reference to the associated bank
  bankId          String?

  /// Optional relation to the bank
  bank            Bank?             @relation(fields: [bankId], references: [id])
  /// Account balances relation
  AccountBalances AccountBalances[]
  // Map the model to the database table
  @@map("account")
}

/// Account balances model, used to store the balance of an account at a specific time when scraping from bank records
model AccountBalances {
  /// Unique identifier for the account balance
  id         String   @id @default(cuid())
  /// Date and time when the account balance was created
  createdAt  DateTime @default(now())
  /// Balance of the account
  balance    Decimal
  /// Source of the account balance (eg: bank statement, bank API, scraper, etc.)
  source     String

  /// Account ID
  accountId String

  /// Account Relation
  account   Account @relation(fields: [accountId], references: [id])
  // Map the model to the database table
  @@map("account_balances")
}

/// Bank model
model Bank {
  /// Unique identifier for the bank
  id           String    @id @default(cuid())
  /// Date and time when the bank was created
  createdAt    DateTime  @default(now())
  /// Date and time when the bank was last updated
  updatedAt    DateTime  @updatedAt
  /// English name of the bank
  nameEn       String
  /// Arabic name of the bank
  nameAr       String
  /// IBAN (International Bank Account Number) code prefix of the bank
  ibanCode     String    @unique
  /// SWIFT (Society for Worldwide Interbank Financial Telecommunication) code of the bank
  swiftCode    String
  /// Abbreviated code for the bank (internal usage for ABK system)
  codeAbk      Int?
  /// Address of the bank (headquarters or branch)
  address      String
  /// Type of transfer the bank supports (e.g., LCL, TRF)
  transferType String?
  /// Indicates whether the record is deleted (soft delete)
  isDeleted    Boolean   @default(false)

  /// Relation to accounts
  accounts     Account[]
  // Map the model to the database table
  @@map("bank")
}
